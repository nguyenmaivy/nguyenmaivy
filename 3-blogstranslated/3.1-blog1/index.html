<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="vynguyen08257@gmail.com"><link rel=icon href=../../images/favicon.png type=image/png><title>Blog 1 :: Internship Report</title>
<link href=../../css/nucleus.css?1765465501 rel=stylesheet><link href=../../css/fontawesome-all.min.css?1765465501 rel=stylesheet><link href=../../css/hybrid.css?1765465501 rel=stylesheet><link href=../../css/featherlight.min.css?1765465501 rel=stylesheet><link href=../../css/perfect-scrollbar.min.css?1765465501 rel=stylesheet><link href=../../css/auto-complete.css?1765465501 rel=stylesheet><link href=../../css/atom-one-dark-reasonable.css?1765465501 rel=stylesheet><link href=../../css/theme.css?1765465501 rel=stylesheet><link href=../../css/hugo-theme.css?1765465501 rel=stylesheet><link href=../../css/theme-workshop.css?1765465501 rel=stylesheet><script src=../../js/jquery-3.3.1.min.js?1765465501></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../3-blogstranslated/3.1-blog1/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../js/lunr.min.js?1765465501></script><script type=text/javascript src=../../js/auto-complete.js?1765465501></script><script type=text/javascript>var baseurl="https://nguyenmaivy.github.io/nguyenmaivy/"</script><script type=text/javascript src=../../js/search.js?1765465501></script></div><div class=highlightable><ul class=topics><li data-nav-id=/1-worklog/ title=Worklog class=dd-item><a href=../../1-worklog/><b>1. </b>Worklog
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/1-worklog/1.1-week1/ title="Week 1 Worklog" class=dd-item><a href=../../1-worklog/1.1-week1/><b>1.1. </b>Week 1 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.2-week2/ title="Week 2 Worklog" class=dd-item><a href=../../1-worklog/1.2-week2/><b>1.2. </b>Week 2 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.3-week3/ title="Week 3 Worklog" class=dd-item><a href=../../1-worklog/1.3-week3/><b>1.3. </b>Week 3 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.4-week4/ title="Week 4 Worklog" class=dd-item><a href=../../1-worklog/1.4-week4/><b>1.4. </b>Week 4 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.5-week5/ title="Week 5 Worklog" class=dd-item><a href=../../1-worklog/1.5-week5/><b>1.5. </b>Week 5 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.6-week6/ title="Week 6 Worklog" class=dd-item><a href=../../1-worklog/1.6-week6/><b>1.6. </b>Week 6 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.7-week7/ title="Week 7 Worklog" class=dd-item><a href=../../1-worklog/1.7-week7/><b>1.7. </b>Week 7 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.8-week8/ title="Week 8 Worklog" class=dd-item><a href=../../1-worklog/1.8-week8/><b>1.8. </b>Week 8 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.10-week10/ title="Worklog Week 10" class=dd-item><a href=../../1-worklog/1.10-week10/><b>1.10. </b>Worklog Week 10
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.9-week9/ title="Worklog Week 9" class=dd-item><a href=../../1-worklog/1.9-week9/><b>1.9. </b>Worklog Week 9
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.11-week11/ title="Worklog Week 11" class=dd-item><a href=../../1-worklog/1.11-week11/><b>1.11. </b>Worklog Week 11
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/2-proposal/ title=Proposal class=dd-item><a href=../../2-proposal/><b>2.</b>Proposal
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/ title="Translated Blogs" class="dd-item
parent"><a href=../../3-blogstranslated/><b>3. </b>Translated Blogs
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/3-blogstranslated/3.1-blog1/ title="Blog 1" class="dd-item
active"><a href=../../3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.2-blog2/ title="Blog 2" class=dd-item><a href=../../3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.3-blog3/ title="Blog 3" class=dd-item><a href=../../3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.4-blog4/ title="Blog 4" class=dd-item><a href=../../3-blogstranslated/3.4-blog4/><b>3.4. </b>Blog 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.5-blog5/ title="Blog 5" class=dd-item><a href=../../3-blogstranslated/3.5-blog5/><b>3.6. </b>Blog 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.6-blog6/ title="Blog 5" class=dd-item><a href=../../3-blogstranslated/3.6-blog6/><b>3.6. </b>Blog 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.7-blog7/ title="Blog 7" class=dd-item><a href=../../3-blogstranslated/3.7-blog7/><b>3.7. </b>Blog 7
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.8-blog8/ title="Blog 8" class=dd-item><a href=../../3-blogstranslated/3.8-blog8/><b>3.8. </b>Blog 8
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.9-blog9/ title="Blog 9" class=dd-item><a href=../../3-blogstranslated/3.9-blog9/><b>3.9. </b>Blog 9
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/4-eventparticipated/ title="Events Participated" class=dd-item><a href=../../4-eventparticipated/><b>4. </b>Events Participated
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/ title=Workshop class=dd-item><a href=../../5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.1-workshop-overview/ title=Introduction class=dd-item><a href=../../5-workshop/5.1-workshop-overview/><b>5.1. </b>Introduction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.2-prerequiste/ title=Prerequiste class=dd-item><a href=../../5-workshop/5.2-prerequiste/><b>5.2. </b>Prerequiste
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.3-s3-vpc/ title="Access S3 from VPC" class=dd-item><a href=../../5-workshop/5.3-s3-vpc/><b>5.3. </b>Access S3 from VPC
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.3-s3-vpc/5.3.1-create-gwe/ title="Create a gateway endpoint" class=dd-item><a href=../../5-workshop/5.3-s3-vpc/5.3.1-create-gwe/><b>5.3.1 </b>Create a gateway endpoint
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.3-s3-vpc/5.3.2-test-gwe/ title="Test the Gateway Endpoint" class=dd-item><a href=../../5-workshop/5.3-s3-vpc/5.3.2-test-gwe/><b>5.3.2 </b>Test the Gateway Endpoint
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/5.4-s3-onprem/ title="Access S3 from on-premises" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/><b>5.4. </b>Access S3 from on-premises
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.4-s3-onprem/5.4.1-prepare/ title="Prepare the environment" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/5.4.1-prepare/><b>5.4.1 </b>Prepare the environment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/ title="Create an S3 Interface endpoint" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/><b>5.4.2 </b>Create an S3 Interface endpoint
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/ title="Test the Interface Endpoint" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/><b>5.4.3 </b>Test the Interface Endpoint
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.4-s3-onprem/5.4.4-dns-simulation/ title="On-premises DNS Simulation" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/5.4.4-dns-simulation/><b>5.4.4 </b>On-premises DNS Simulation
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/5.5-policy/ title="VPC Endpoint Policies" class=dd-item><a href=../../5-workshop/5.5-policy/><b>5.5. </b>VPC Endpoint Policies
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.6-cleanup/ title="Clean up" class=dd-item><a href=../../5-workshop/5.6-cleanup/><b>5.6. </b>Clean up
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/6-self-evaluation/ title=Self-Assessment class=dd-item><a href=../../6-self-evaluation/><b>6. </b>Self-Assessment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/7-feedback/ title="Sharing, Contributing Opinions" class=dd-item><a href=../../7-feedback/><b>7. </b>Sharing, Contributing Opinions
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://nguyenmaivy.github.io/nguyenmaivy/3-blogstranslated/3.1-blog1/ selected>English</option><option id=vi value=https://nguyenmaivy.github.io/nguyenmaivy/vi/3-blogstranslated/3.1-blog1/>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../>Internship Report</a> > <a href=../../3-blogstranslated/>Translated Blogs</a> > Blog 1</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#netapp-trident-protect>NetApp Trident Protect</a></li><li><a href=#software-architecture>Software architecture</a></li><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#walkthrough>Walkthrough</a></li><li><a href=#backup-restore-and-migration-walkthrough>Backup, restore, and migration walkthrough</a><ul><li><a href=#migrate-between-storage-services>Migrate between storage services</a></li><li><a href=#cleaning-up>Cleaning up</a></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Blog 1</h1><h1 id=backup-amazon-elastic-kubernetes-service-eks-resources-using-netapp-trident-protect>Backup Amazon Elastic Kubernetes Service (EKS) resources using NetApp Trident Protect</h1><p>Kubernetes is an open source container orchestration platform that automates the deployment, scaling, and management of containerized applications. For users running applications and workloads on <a href=https://kubernetes.io/>Kubernetes</a>, protecting resources and data from accidental deletion or hardware failures is crucial for maintaining business continuity and meeting compliance requirements. While Kubernetes provides high availability through its control plane and worker node redundancy, it does not inherently protect against human errors, such as accidental deletion of namespaces, deployments, or persistent volumes, nor does it safeguard against regional failures or data corruption.</p><p>The complexity of modern microservices architectures and the increasing scale of Kubernetes deployments make it even more critical to maintain regular, tested backups that can be restored consistently across different environments and Amazon Web Services <a href=https://aws.amazon.com/about-aws/global-infrastructure/regions_az/>(AWS) Regions</a>. This includes backing up essential components such as entire namespaces, persistent volumes containing application data, custom resources, and configuration objects. Without proper backup mechanisms, organizations risk extended outages, data loss, and potential breach of service level agreements (SLAs). These can result in significant financial impact and damage to customer trust. This post introduces a new data protection tool and provides a step-by-step guide to implementing a proof-of-concept within a Kubernetes environment.</p><h2 id=netapp-trident-protect>NetApp Trident Protect</h2><p><a href=https://docs.netapp.com/us-en/trident/trident-protect/learn-about-trident-protect.html>NetApp Trident Protect</a> is a free tool from NetApp that provides Kubernetes cluster data protection, data migration, disaster recovery, and movement of containerized workloads across AWS Regions and on-premises environments. It enables on-demand or scheduled data protection tasks for Kubernetes cluster resources and persistent volumes to externally supported storage backends such as <a href=https://aws.amazon.com/s3/>Amazon S3</a>. It offers automation capabilities through its Kubernetes-native API and powerful <code>tridentctl-protect</code> CLI, enabling programmatic access for seamless integration with existing workflows. AWS users can use Trident Protect to handle operations such as cross-cluster disaster recovery (between AWS Regions or within a Region), migration of stateful services between storage services, or moving resources running on a self-managed Kubernetes cluster into <a href=https://aws.amazon.com/aws.amazon.com/pm/eks>Amazon Elastic Kubernetes Service</a> (Amazon EKS). The Amazon EKS and Trident backup architecture is shown in Figure 1.</p><p><img alt="Amazon EKS and Trident" src=../../images/3-blogstranslated/3.1-blog1/Amazon-EKS-and-Trident-backup-architecture.png.png></p><blockquote><p><em>Figure 1. Amazon EKS and Trident backup architecture.</em></p></blockquote><p><a href=https://aws.amazon.com/fsx/netapp-ontap/>Amazon FSx for NetApp ONTAP</a> file system is a fully managed shared storage service, built on NetApp’s popular ONTAP file system. It provides users access to ONTAP’s enterprise storage features and services, such as thin provisioning, data deduplication, and the Snapshot functionality that drives NetApp agility in storage provisioning and data protection.</p><p>In this post, we focus on using Trident Protect with our AWS retail sample store application to handle data protection and migration tasks running on an EKS cluster. We also dive deep into some backup, recovery, and storage migration options that help you decide what is best to implement in your organization’s environment. The following architecture creates backups in our local AWS Region, which can be used to restore other namespaces within the same cluster and migrate from different AWS storage services.</p><h2 id=software-architecture>Software architecture</h2><p>The AWS <a href=https://github.com/aws-containers/retail-store-sample-app>retail store sample application</a> is built from microservices and backed by several stateful services. In total they consume four <a href=https://kubernetes.io/docs/concepts/storage/persistent-volumes/>Persistent Volume Claims</a> (PVC) for each stack as in Figure 2.</p><ul><li>Assets: Serves static assets such as images related to the product catalog—needs RWX volume such as NFS.</li><li>Orders: Receive and process user orders backed by MySQL DB and RabbitMQ—needs two RWO block storage volumes.</li><li>Catalog: Product listings and details backed by MySQL DB—needs RWO block storage volume.</li></ul><p><img alt="Sample retail store application" src=../../images/3-blogstranslated/3.1-blog1/Sample-retail-store-application.png.png></p><blockquote><p><em>Figure 2. Sample retail store application.</em></p></blockquote><h2 id=prerequisites>Prerequisites</h2><p>To manually provision the resources used in this walkthrough, the following list provides the components and versions used. Alternatively, use the provided Terraform resources to automate the entire deployment as shown in Step 1 of the walkthrough.</p><ul><li>Amazon EKS cluster deployed version 1.32<ul><li><a href=https://docs.aws.amazon.com/eks/latest/userguide/pod-id-agent-setup.html>Pod Identity</a> (eks-pod-identity-agent) add-on version v1.3.4</li><li><a href=https://docs.netapp.com/us-en/trident/trident-use/trident-aws-addon.html>NetApp Trident CSI add-on</a> version 25.06</li><li><a href=https://docs.aws.amazon.com/eks/latest/userguide/workloads-add-ons-available-eks.html#add-ons-aws-ebs-csi-driver>Amazon EBS CSI add-on</a> version v1.40.0-eksbuild.1</li><li><a href=https://docs.aws.amazon.com/eks/latest/userguide/csi-snapshot-controller.html>Snapshot controller</a> (snapshot-controller) add-on version v8.0.0<ul><li>Create VolumeSnapshotClass for <a href=https://aws.amazon.com/ebs/>Amazon Elastic Block Storage (Amazon EBS)</a> and FSx for ONTAP (sample manifests are provisioned as part of the terraform deployment).</li></ul></li><li><a href=https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html>Load balancer controller</a> (aws-load-balancer-controller) version 2.11.0</li></ul></li><li>Deployed <a href=https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/getting-started.html>FSx for ONTAP</a> file system.</li></ul><h2 id=walkthrough>Walkthrough</h2><ol><li>Create necessary infrastructure with Terraform</li></ol><p>Clone the sample repository from GitHub and create all relevant resources using the Terraform code in the repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/aws-samples/sample-eks-backup-with-trident-protect.git
</span></span><span style=display:flex><span>cd sample-eks-backup-with-trident-protect/terraform
</span></span><span style=display:flex><span>terraform init 
</span></span><span style=display:flex><span>terraform apply -auto-approve
</span></span></code></pre></div><p>NOTE: The Terraform script prompts you to input a public IP address. This is the host’s address that accesses the UI of the sample application.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>var.ui_service_public_ip 
</span></span><span style=display:flex><span>The public IP addess of the host that will access the sample application &gt;UI from the web browser  
</span></span><span style=display:flex><span>Enter a value: A.B.C.D/32   
</span></span></code></pre></div><p>This deployment can take 20-25 minutes to complete. When finished, the output of the command should look like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>fsx-management-ip <span style=color:#f92672>=</span> toset<span style=color:#f92672>([</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;10.0.1.13&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>fsx-ontap-id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fs-a1b2c3d4e5f6g7h8i&#34;</span>
</span></span><span style=display:flex><span>fsx-svm-name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ekssvm&#34;</span>
</span></span><span style=display:flex><span>region <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;us-east-1&#34;</span>
</span></span><span style=display:flex><span>secret_arn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;arn:aws:secretsmanager:us-east-1:0123456789ab:secret:fsxn-password-secret-8DKLpwTi-8DLlwE&#34;</span>
</span></span><span style=display:flex><span>zz_update_kubeconfig_command <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aws eks update-kubeconfig --name eks-protect-8DKLpwTi --alias eks-primary --region us-east-1&#34;</span>
</span></span></code></pre></div><p>Next, copy and run the <a href=https://aws.amazon.com/cli/>AWS Command Line Interface (AWS CLI)</a> command from the update_kubeconfig_command output and check that you can reach the cluster by running kubectl get nodes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME                         STATUS   ROLES    AGE     VERSION
</span></span><span style=display:flex><span>ip-10-0-1-120.ec2.internal   Ready    &lt;none&gt;   2m15s   v1.32.1-eks-5d632ec
</span></span><span style=display:flex><span>ip-10-0-1-125.ec2.internal   Ready    &lt;none&gt;   95m     v1.32.1-eks-5d632ec
</span></span><span style=display:flex><span>ip-10-0-2-42.ec2.internal    Ready    &lt;none&gt;   95m     v1.32.1-eks-5d632ec
</span></span><span style=display:flex><span>ip-10-0-2-95.ec2.internal    Ready    &lt;none&gt;   2m9s    v1.32.1-eks-5d632ec
</span></span></code></pre></div><ol start=2><li>Deploy Trident Protect into EKS cluster</li></ol><p>Run the following commands to install the Trident Protect:</p><p>IMPORTANT: Make sure that you change clusterName to the EKS cluster name in your environment.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add netapp-trident-protect https://netapp.github.io/trident-protect-helm-chart
</span></span><span style=display:flex><span>helm install trident-protect netapp-trident-protect/trident-protect --set clusterName<span style=color:#f92672>=</span>eks-protect-ymd8hvHr --version 100.2506.0 --create-namespace --namespace trident-protect
</span></span></code></pre></div><p>Expected output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#e6db74>&#34;netapp-trident-protect&#34;</span> has been added to your repositories
</span></span><span style=display:flex><span>NAME: trident-protect
</span></span><span style=display:flex><span>LAST DEPLOYED: Tue Jul <span style=color:#ae81ff>22</span> 19:44:30 <span style=color:#ae81ff>2025</span>
</span></span><span style=display:flex><span>NAMESPACE: trident-protect
</span></span><span style=display:flex><span>STATUS: deployed
</span></span><span style=display:flex><span>REVISION: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>TEST SUITE: None
</span></span></code></pre></div><ol start=3><li>Create S3 bucket</li></ol><p>If you have an existing S3 bucket, then you can use it. If not, then use the following steps to create a new S3 bucket. Replace <code>&lt;bucket_name> </code>and <code>&lt;aws_region></code> with your values:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws s3 mb s3://&lt;bucket_name&gt; --region &lt;aws_region&gt;
</span></span></code></pre></div><ol start=4><li>Create an EKS secret to store user credentials – Optional</li></ol><p>EKS Pod Identity is the recommended method for IAM authentication, which has been configured as part of the initial terraform deployments. If you don’t want to use EKS Pod Identity for IAM authentication then create a secret to store the trident protect user AWS <code>accessKey</code> and <code>secretKey</code>. Make sure that the user credentials you provide have the necessary permissions to access the S3 bucket—go to the example <a href=https://docs.netapp.com/us-en/trident/trident-protect/trident-protect-appvault-custom-resources.html#s3-compatible-storage-iam-permissions>Amazon S3 policy statement</a>.</p><p>Use the following example to create the secret:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create secret generic &lt;secret-name&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--from-literal<span style=color:#f92672>=</span>accessKeyID<span style=color:#f92672>=</span>&lt;accessKey&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--from-literal<span style=color:#f92672>=</span>secretAccessKey<span style=color:#f92672>=</span>&lt;seceretKey&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>-n trident-protect
</span></span></code></pre></div><ol start=5><li>Create Trident Protect AppVault</li></ol><p>Create the Trident Protect <code>AppVault</code>. The <code>AppVault</code> points to the S3 bucket where both snapshots and backup content, data and metadata is stored. The <code>AppVault</code> is created in the dedicated <code>trident-protect</code> backup namespace created in Step 2 and can be secured with <a href=https://docs.netapp.com/us-en/trident/trident-protect/manage-authorization-access-control.html>role-based access control (RBAC)</a> to restrict access to privileged objects to administrators.</p><p>All remaining tasks are created either in the original application namespace or the target one in case of the restore examples. To create the <code>AppVault</code>, use the <code>protect-vault.yaml</code> sample manifest.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd &lt;repo&gt;/manifests
</span></span></code></pre></div><p>Update the following parameters:</p><ul><li><code>providerConfig.s3.bucketName</code>: the S3 bucket name</li><li><code>providerConfig.s3.endpoint</code>: the S3 endpoint if the bucket is not in the us-east-1 Region</li><li><code>useIAM</code>: Use EKS Pod Identity for IAM authentication</li><li><code>providerCredentials.accessKeyID</code>.name: the EKS secret name from the previous step</li><li><code>providerCredentials.secretAccessKey</code>.name: the EKS secret name from the previous step
IMPORTANT: When using <code>useIAM: true</code> with EKS Pod Identity don’t set <code>providerCredentials.accessKeyID.name</code> and <code>providerCredentials.secretAccessKey.name</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apiVersion: protect.trident.netapp.io/v1
</span></span><span style=display:flex><span>kind: AppVault
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: amazon-s3-trident-protect-src-bucket
</span></span><span style=display:flex><span>  namespace: trident-protect
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  properties:
</span></span><span style=display:flex><span>    dataMoverPasswordSecretRef: my-optional-data-mover-secret
</span></span><span style=display:flex><span>  providerType: AWS
</span></span><span style=display:flex><span>  providerConfig:
</span></span><span style=display:flex><span>    s3:
</span></span><span style=display:flex><span>      bucketName: trident-protect-blog
</span></span><span style=display:flex><span>      endpoint: s3.amazonaws.com
</span></span><span style=display:flex><span>      useIAM: true
</span></span><span style=display:flex><span>  <span style=color:#75715e># providerCredentials:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   accessKeyID:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#     valueFromSecret:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#       key: accessKeyID</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#       name: s3-secret</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   secretAccessKey:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#     valueFromSecret:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#       key: secretAccessKey</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#       name: s3-secret</span>
</span></span></code></pre></div><p>Run the following command to create the <code>AppVault</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create -f protect-vault.yaml
</span></span></code></pre></div><p>To check if the AppVault was created successfully, run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get appvault -n trident-protect
</span></span></code></pre></div><p>Expected output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME                STATE       ERROR   MESSAGE   AGE
</span></span><span style=display:flex><span>eks-protect-vault   Available                     4s
</span></span></code></pre></div><ol start=6><li>Create Trident Protect Application</li></ol><p>To perform data protection operations on your Amazon EKS applications, you need to create a Trident Protect Application resource. An application can be defined in the following ways:</p><ul><li>As a namespace whereby everything that is part of the namespace must be protected</li><li>As a subset of a namespace based on labels if you only want to protect part of a namespace (for example, only the PVC)</li><li>It can span across multiple namespaces</li><li>An application can also take into account cluster-wide resources
To define the namespaces in which the application resources exist, use spec.includedNamespaces and specify namespace labels or a namespace name. You can use this sample <a href=https://owolabip/aws-eks-trident-protect-blog/-/blob/main/manifests/trident-application.yaml>trident-application.yaml</a> manifest to define an Application for the sample-app.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apiVersion: protect.trident.netapp.io/v1
</span></span><span style=display:flex><span>kind: Application
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: sample-app
</span></span><span style=display:flex><span>  namespace: tenant0
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  includedNamespaces:
</span></span><span style=display:flex><span>    - namespace:  tenant0
</span></span></code></pre></div><p>Run the following to create the Application:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd &lt;repo&gt;/manifests
</span></span><span style=display:flex><span>kubectl create -f trident-application.yaml
</span></span></code></pre></div><p>To check that the application was created successfully run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get application -n tenant0
</span></span></code></pre></div><p>Expected output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME         PROTECTION STATE   AGE
</span></span><span style=display:flex><span>sample-app   None               14s
</span></span></code></pre></div><h2 id=backup-restore-and-migration-walkthrough>Backup, restore, and migration walkthrough</h2><p><strong>Create application backup</strong></p><p>Trident Protect has several data protection options available:</p><ol><li><a href=https://docs.netapp.com/us-en/trident/trident-protect/trident-protect-protect-apps.html#create-an-on-demand-snapshot>On-demand snapshot</a></li><li><a href=https://docs.netapp.com/us-en/trident/trident-protect/trident-protect-protect-apps.html#create-an-on-demand-backup>On-demand backup</a></li><li><a href=https://docs.netapp.com/us-en/trident/trident-protect/trident-protect-protect-apps.html#create-a-data-protection-schedule>Data protection schedule</a></li><li><a href=https://docs.netapp.com/us-en/trident/trident-protect/trident-protect-use-snapmirror-replication.html>Application replication</a></li><li><a href=https://docs.netapp.com/us-en/trident/trident-protect/trident-protect-migrate-apps.html>Application migration</a></li></ol><p>In this post, we focus on on-demand backup and application migration, but you can read more about how to use the other data protection options in the preceding link references.</p><p>To create an on-demand backup for the sample application, you create a backup resource for the Application you just created and point it to the Amazon S3 created <code>AppVault</code>. You can use the following <code>trident-backup.yaml</code> sample manifest:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apiVersion: protect.trident.netapp.io/v1
</span></span><span style=display:flex><span>kind: Backup
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  namespace: tenant0
</span></span><span style=display:flex><span>  name: sample-app-backup-1
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  applicationRef: sample-app
</span></span><span style=display:flex><span>  appVaultRef: eks-protect-vault
</span></span></code></pre></div><p>Run the following to create the backup:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd &lt;repo&gt;/manifests
</span></span><span style=display:flex><span>kubectl create -f trident-backup.yaml
</span></span></code></pre></div><p>To check if the Backup was created successfully, run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get backup -n tenant0
</span></span></code></pre></div><p>Expected output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME                  APP          RECLAIM POLICY   STATE       ERROR   AGE
</span></span><span style=display:flex><span>sample-app-backup-1   sample-app   Retain           Completed           9m33s
</span></span></code></pre></div><p>IMPORTANT: The state of the backup can be running while the backup is in progress. Wait until the status gets to <code>Completed</code>. If the status is <code>Failed</code>, then use <code>kubectl describe backup -n tenant0 sample-app-backup-1</code> to get more details on the failure.</p><p>If you check your <code>Application</code> Protection State, then it is now set to <code>Partial</code> because you just have an on-demand backup set for your application, but no backup schedule. You can use <code>kubectl describe application -n tenant0</code> to check the status.</p><p><strong>Restore application from a backup</strong></p><p>Trident Protect has several recovery options available:</p><ol><li>Restore from backup</li></ol><ul><li><a href=https://docs.netapp.com/us-en/trident/trident-protect/trident-protect-restore-apps.html#restore-from-a-backup-to-a-different-namespace>Restore from a backup to a different namespace</a></li><li><a href=https://docs.netapp.com/us-en/trident/trident-protect/trident-protect-restore-apps.html#restore-from-a-backup-to-the-original-namespace>Restore from a backup to the original namespace</a></li><li><a href=https://docs.netapp.com/us-en/trident/trident-protect/trident-protect-restore-apps.html#restore-from-a-backup-to-a-different-cluster>Restore from a backup to a different cluster</a></li></ul><ol start=2><li>Restore from snapshot</li></ol><ul><li><a href=https://docs.netapp.com/us-en/trident/trident-protect/trident-protect-restore-apps.html#restore-from-a-snapshot-to-a-different-namespace>Restore from a snapshot to a different namespace</a></li><li><a href=https://docs.netapp.com/us-en/trident/trident-protect/trident-protect-restore-apps.html#restore-from-a-snapshot-to-the-original-namespace>Restore from a snapshot to the original namespace</a></li></ul><p>In this post, we focus on restoring the sample-app backup to a different namespace on the same EKS cluster. You can read more about how to use the other recovery options in the preceding link references. The following is a review of the BackupRestore resources spec:</p><ul><li><code>spec.appArchivePath</code>: The path in the <code>AppVault</code> where the backup contents are stored.
You can retrieve the Archive Path by issuing the following command on your backup:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get backup sample-app-backup-1 -n tenant0 -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.status.appArchivePath}&#39;</span>
</span></span></code></pre></div><ul><li><code>spec.appVaultRef</code>: The name of the <code>AppVault</code> where the backup contents are stored.</li><li><code>spec.namespaceMapping</code>: The mapping of the source namespace of the restore operation to the destination namespace.
You can use the following <code>trident-protect-backup-restore.yaml</code> sample manifest:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apiVersion: protect.trident.netapp.io/v1
</span></span><span style=display:flex><span>kind: BackupRestore
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: sample-app-restore-1
</span></span><span style=display:flex><span>  namespace: tenant1
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  appArchivePath: &lt;APP ARCHIVE PATH&gt;
</span></span><span style=display:flex><span>  appVaultRef: eks-protect-vault
</span></span><span style=display:flex><span>  namespaceMapping: 
</span></span><span style=display:flex><span>    - source: tenant0
</span></span><span style=display:flex><span>      destination: tenant1
</span></span><span style=display:flex><span>  resourceFilter:
</span></span><span style=display:flex><span>    resourceSelectionCriteria: <span style=color:#e6db74>&#34;Exclude&#34;</span>
</span></span><span style=display:flex><span>    resourceMatchers:
</span></span><span style=display:flex><span>      - kind: TargetGroupBinding
</span></span></code></pre></div><p>If you need to choose only specific resources within the application to restore, then use the following filtering to include or exclude resources marked with particular labels.</p><ul><li><code>resourceFilter.resourceSelectionCriteria</code>: Use Include or Exclude to include or exclude a resource defined in resourceMatchers.</li><li><code>resourceFilter.resourceMatchers</code>:<ul><li><code>resourceMatchers[].group</code>: Group of the resource to be filtered</li><li><code>resourceMatchers[].kind</code>: Kind of the resource to be filtered</li><li><code>resourceMatchers[].version</code>: Version of the resource to be filtered</li><li><code>resourceMatchers[].names</code>: Names in the Kubernetes metadata.name field of the resource to be filtered</li><li><code>resourceMatchers[].namespaces</code>: Namespaces in the Kubernetes metadata.name field of the resource to be filtered</li><li><code>resourceMatchers[].labelSelectors</code>: Label selector string in the Kubernetes metadata.name field of the resource</li></ul></li></ul><p>For an example, you could use this sample code to include resources in your <code>BackupRestore</code> manifest:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  resourceFilter:
</span></span><span style=display:flex><span>    resourceSelectionCriteria: <span style=color:#e6db74>&#34;Include&#34;</span>
</span></span><span style=display:flex><span>    resourceMatchers:
</span></span><span style=display:flex><span>      - group: my-resource-group-1
</span></span><span style=display:flex><span>        kind: my-resource-kind-1
</span></span><span style=display:flex><span>        version: my-resource-version-1
</span></span><span style=display:flex><span>        names: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;my-resource-names&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        namespaces: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;my-resource-namespaces&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        labelSelectors: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;trident.netapp.io/os=linux&#34;</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><p>NOTE: The application recovery uses a <code>LoadBalancer</code> Type service in Amazon EKS, thus you should exclude the <code>TargetGroupBinding</code> resources so that the <a href=https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/>AWS Load Balancer Controller</a> can create a new <code>TargetGroupBinding</code> for the new namespace that isn’t in conflict with the existing application on the cluster.</p><p>Run the following to create the <code>BackupRestore</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd &lt;repo&gt;/manifestskubectl
</span></span><span style=display:flex><span>create -f trident-protect-backup-restore.yaml
</span></span></code></pre></div><p>To check if the BackupRestore was created successfully, run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get backuprestore -n tenant1
</span></span></code></pre></div><p>Expected output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME                   STATE       ERROR   AGE
</span></span><span style=display:flex><span>sample-app-restore-1   Completed           115s
</span></span></code></pre></div><p>IMPORTANT: The state of the <code>BackupRestore</code> can be running while the restore is in progress. Wait until the status gets to <code>Completed</code>. If the status is <code>Failed</code>, then use <code>kubectl describe backuprestore -n tenant1 sample-app-restore-1</code> to get more details on the failure.</p><p>After the restore process is finished, you can verify that your recovered application is up and running by accessing the UI service endpoint in your browser. You can get the UI service endpoint by issuing the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get svc ui -n tenant1 --output jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.status.loadBalancer.ingress[0].hostname}&#39;</span>
</span></span></code></pre></div><p>If everything was successful, then you should get the UI that looks like Figure 3:</p><p>![alt text](<img alt="Restored retail store application" src=../../images/3-blogstranslated/3.1-blog1/Restored-retail-store-application.png.png></p><blockquote><p><em>Hình 3. Restored retail store application.</em></p></blockquote><h3 id=migrate-between-storage-services>Migrate between storage services</h3><p>On this step, you migrate parts of the sample application stateful services from one storage service to another. You should do that using the <code>storageClassMapping</code> feature of the Trident Protect <code>BackupRestore</code>. You should migrate the catalog service MySQL database from an EBS volume to an FSx for ONTAP volume using iSCSI presented LUNs.</p><p>To do that, execute two <code>BackupRestore</code> resources. One recovers all sample-application resources and data except for the <code>catalog-mysql</code> statefulset, and the other recovers and migrates the <code>catalog-mysql</code> statefulset from Amazon EBS to FSx for ONTAP block storage.</p><p>Review the <code>trident-protect-migrate.yaml</code>. Use <code>resourceFilter</code> to exclude and include resources from the recovery process and <code>storageClassMapping</code> to migrate stateful resources to different storage backends.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>resourceFilter:
</span></span><span style=display:flex><span>    resourceSelectionCriteria: <span style=color:#e6db74>&#34;Exclude&#34;</span>
</span></span><span style=display:flex><span>    resourceMatchers:
</span></span><span style=display:flex><span>      - kind: StatefulSet
</span></span><span style=display:flex><span>        names: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;catalog-mysql&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      - kind: TargetGroupBinding
</span></span></code></pre></div><p>IMPORTANT: Make sure you update <code>spec.appArchivePath</code> on both resources. You can retrieve the Archive Path by issuing the following command on your backup:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get backup sample-app-backup-1 -n tenant0 -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.status.appArchivePath}&#39;</span>
</span></span></code></pre></div><p>You can check the source application and see that the original volume is using Amazon EBS by using the same command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pvc data-catalog-mysql-0 -n tenant0
</span></span></code></pre></div><p>Expected result:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME                   STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
</span></span><span style=display:flex><span>data-catalog-mysql-0   Bound    pvc-0d795501-aca2-4e10-98b5-111ecc3aef2c   30Gi       RWO            ebs-csi        &lt;unset&gt;                 71m
</span></span></code></pre></div><p>Run the following to create the <code>BackupRestore</code> resources needed for the migration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd &lt;repo&gt;/manifests
</span></span><span style=display:flex><span>kubectl create -f trident-protect-migrate.yaml
</span></span></code></pre></div><p>To check if the <code>BackupRestore</code> resources were created successfully run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get backuprestore -n tenant2
</span></span></code></pre></div><p>IMPORTANT: The state of the <code>BackupRestore</code> can be <code>running</code> while the restore is in progress. Wait until the status gets to <code>Completed</code>. If the status is <code>Failed</code>, use <code>kubectl describe backuprestore -n tenant2 sample-app-migrate-#</code> to get more details on the failure.</p><p>Expected result:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME                   STATE       ERROR   AGE
</span></span><span style=display:flex><span>sample-app-migrate-1   Completed           26m
</span></span><span style=display:flex><span>sample-app-migrate-2   Completed           38s
</span></span></code></pre></div><p>You can check that the <code>catalog-mysql</code> PVC was migrated from Amazon EBS to FSx for ONTAP by issuing the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pvc data-catalog-mysql-0 -n tenant2
</span></span></code></pre></div><p>Expected result:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME                   STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS      VOLUMEATTRIBUTESCLASS   AGE
</span></span><span style=display:flex><span>data-catalog-mysql-0   Bound    pvc-8e45fa11-13ad-490d-b70c-d649b6fef4e9   30Gi       RWO            trident-csi-san   &lt;unset&gt;                 118s
</span></span></code></pre></div><p>After the migration process is finished, you can verify if your migrated application is up and running by accessing the UI service endpoint in your browser. You can get the UI service endpoint by issuing the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get svc ui -n tenant2 --output jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.status.loadBalancer.ingress[0].hostname}&#39;</span>
</span></span></code></pre></div><p>If everything was successful, then you should get the UI that looks like Figure 4:</p><p>![alt text](<img alt="Restored retail store application after PVC migration" src=../../images/3-blogstranslated/3.1-blog1/Restored-retail-store-application-after-PVC-migration.png.png></p><blockquote><p><em>Hình 4. Restored retail store application after PVC migration.</em></p></blockquote><p>Congratulations! You’ve completed and mastered the basics of Amazon EKS backup, recovery, and migration using NetApp Trident Protect. This guide can be used as a best practice to implement protection, migration, and disaster recovery in your environment.</p><h3 id=cleaning-up>Cleaning up</h3><p>To avoid unnecessary charges, make sure to delete all of the resources created with Terraform by running the following script from your terminal:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sh ../scripts/cleanup.sh
</span></span></code></pre></div><p>If you created a new S3 bucket for this exercise, then clean up by going to the Amazon S3 console, <a href=https://docs.aws.amazon.com/AmazonS3/latest/userguide/empty-bucket.html>emptying</a> the bucket, and <a href=https://docs.aws.amazon.com/AmazonS3/latest/userguide/delete-bucket.html>deleting</a> it.</p><h3 id=conclusion>Conclusion</h3><p>In conclusion, NetApp Trident Protect provides a powerful solution for streamlining data protection of Kubernetes environments. This approach addresses the critical need for comprehensive backup strategies in cloud-native architectures. NetApp Trident Protect enables users to efficiently create and manage backups of entire namespaces, persistent volumes, and other essential Amazon EKS resources, making sure of business continuity and compliance with data protection requirements.</p><p>The step-by-step guide presented in this post demonstrates the ease of setting up and using NetApp Trident Protect with Amazon EKS, Amazon FSx for NetApp ONTAP, and Amazon EBS. Thank you for reading this post. Leave any comments or questions in the comments section.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../3-blogstranslated/ title="Translated Blogs"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../3-blogstranslated/3.2-blog2/ title="Blog 2" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../js/clipboard.min.js?1765465501></script><script src=../../js/perfect-scrollbar.min.js?1765465501></script><script src=../../js/perfect-scrollbar.jquery.min.js?1765465501></script><script src=../../js/jquery.sticky.js?1765465501></script><script src=../../js/featherlight.min.js?1765465501></script><script src=../../js/highlight.pack.js?1765465501></script><script>hljs.initHighlightingOnLoad()</script><script src=../../js/modernizr.custom-3.6.0.js?1765465501></script><script src=../../js/learn.js?1765465501></script><script src=../../js/hugo-learn.js?1765465501></script><link href=../../mermaid/mermaid.css?1765465501 rel=stylesheet><script src=../../mermaid/mermaid.js?1765465501></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>