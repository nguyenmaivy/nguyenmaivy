<!doctype html><html lang=vi class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="vynguyen08257@gmail.com"><link rel=icon href=../../../images/favicon.png type=image/png><title>Blog 7 :: Báo cáo thực tập</title>
<link href=../../../css/nucleus.css?1765465502 rel=stylesheet><link href=../../../css/fontawesome-all.min.css?1765465502 rel=stylesheet><link href=../../../css/hybrid.css?1765465502 rel=stylesheet><link href=../../../css/featherlight.min.css?1765465502 rel=stylesheet><link href=../../../css/perfect-scrollbar.min.css?1765465502 rel=stylesheet><link href=../../../css/auto-complete.css?1765465502 rel=stylesheet><link href=../../../css/atom-one-dark-reasonable.css?1765465502 rel=stylesheet><link href=../../../css/theme.css?1765465502 rel=stylesheet><link href=../../../css/hugo-theme.css?1765465502 rel=stylesheet><link href=../../../css/theme-workshop.css?1765465502 rel=stylesheet><script src=../../../js/jquery-3.3.1.min.js?1765465502></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../../vi/3-blogstranslated/3.7-blog7/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../../js/lunr.min.js?1765465502></script><script type=text/javascript src=../../../js/auto-complete.js?1765465502></script><script type=text/javascript>var baseurl="https://nguyenmaivy.github.io/nguyenmaivy//vi"</script><script type=text/javascript src=../../../js/search.js?1765465502></script></div><div class=highlightable><ul class=topics><li data-nav-id=/vi/2-proposal/ title="Bản đề xuất" class=dd-item><a href=../../../vi/2-proposal/><b>2. </b>Bản đề xuất
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/ title="Nhật ký công việc" class=dd-item><a href=../../../vi/1-worklog/><b>1. </b>Nhật ký công việc
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/1-worklog/1.1-week1/ title="Worklog Tuần 1" class=dd-item><a href=../../../vi/1-worklog/1.1-week1/><b>1.1. </b>Worklog Tuần 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.10-week10/ title="Worklog Tuần 10" class=dd-item><a href=../../../vi/1-worklog/1.10-week10/><b>1.10. </b>Worklog Tuần 10
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.11-week11/ title="Worklog Tuần 11" class=dd-item><a href=../../../vi/1-worklog/1.11-week11/><b>1.11. </b>Worklog Tuần 11
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.2-week2/ title="Worklog Tuần 2" class=dd-item><a href=../../../vi/1-worklog/1.2-week2/><b>1.2. </b>Worklog Tuần 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.3-week3/ title="Worklog Tuần 3" class=dd-item><a href=../../../vi/1-worklog/1.3-week3/><b>1.3. </b>Worklog Tuần 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.4-week4/ title="Worklog Tuần 4" class=dd-item><a href=../../../vi/1-worklog/1.4-week4/><b>1.4. </b>Worklog Tuần 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.5-week5/ title="Worklog Tuần 5" class=dd-item><a href=../../../vi/1-worklog/1.5-week5/><b>1.5. </b>Worklog Tuần 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.6-week6/ title="Worklog Tuần 6" class=dd-item><a href=../../../vi/1-worklog/1.6-week6/><b>1.6. </b>Worklog Tuần 6
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.7-week7/ title="Worklog Tuần 7" class=dd-item><a href=../../../vi/1-worklog/1.7-week7/><b>1.7. </b>Worklog Tuần 7
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.8-week8/ title="Worklog Tuần 8" class=dd-item><a href=../../../vi/1-worklog/1.8-week8/><b>1.8. </b>Worklog Tuần 8
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.9-week9/ title="Worklog Tuần 9" class=dd-item><a href=../../../vi/1-worklog/1.9-week9/><b>1.9. </b>Worklog Tuần 9
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/3-blogstranslated/ title="Các bài blogs đã dịch" class="dd-item
parent"><a href=../../../vi/3-blogstranslated/><b>3. </b>Các bài blogs đã dịch
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/3-blogstranslated/3.1-blog1/ title="Blog 1" class=dd-item><a href=../../../vi/3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.2-blog2/ title="Blog 2" class=dd-item><a href=../../../vi/3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.3-blog3/ title="Blog 3" class=dd-item><a href=../../../vi/3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.4-blog4/ title="Blog 4" class=dd-item><a href=../../../vi/3-blogstranslated/3.4-blog4/><b>3.4. </b>Blog 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.5-blog5/ title="Blog 5" class=dd-item><a href=../../../vi/3-blogstranslated/3.5-blog5/><b>3.6. </b>Blog 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.6-blog6/ title="Blog 5" class=dd-item><a href=../../../vi/3-blogstranslated/3.6-blog6/><b>3.6. </b>Blog 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.7-blog7/ title="Blog 7" class="dd-item
active"><a href=../../../vi/3-blogstranslated/3.7-blog7/><b>3.7. </b>Blog 7
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.8-blog8/ title="Blog 8" class=dd-item><a href=../../../vi/3-blogstranslated/3.8-blog8/><b>3.8. </b>Blog 8
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.9-blog9/ title="Blog 9" class=dd-item><a href=../../../vi/3-blogstranslated/3.9-blog9/><b>3.9. </b>Blog 9
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/4-eventparticipated/ title="Các events đã tham gia" class=dd-item><a href=../../../vi/4-eventparticipated/><b>4. </b>Các events đã tham gia
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/ title=Workshop class=dd-item><a href=../../../vi/5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.1-workshop-overview/ title="Giới thiệu" class=dd-item><a href=../../../vi/5-workshop/5.1-workshop-overview/><b>5.1. </b>Giới thiệu
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.2-prerequiste/ title="Các bước chuẩn bị" class=dd-item><a href=../../../vi/5-workshop/5.2-prerequiste/><b>5.2. </b>Các bước chuẩn bị
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.3-s3-vpc/ title="Truy cập S3 từ VPC" class=dd-item><a href=../../../vi/5-workshop/5.3-s3-vpc/><b>5.3. </b>Truy cập S3 từ VPC
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.3-s3-vpc/5.3.1-create-gwe/ title="Tạo một Gateway Endpoint" class=dd-item><a href=../../../vi/5-workshop/5.3-s3-vpc/5.3.1-create-gwe/><b>5.3.1 </b>Tạo một Gateway Endpoint
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.3-s3-vpc/5.3.2-test-gwe/ title="Kiểm tra Gateway Endpoint" class=dd-item><a href=../../../vi/5-workshop/5.3-s3-vpc/5.3.2-test-gwe/><b>5.3.2 </b>Kiểm tra Gateway Endpoint
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/5.4-s3-onprem/ title="Truy cập S3 từ môi trường truyền thống" class=dd-item><a href=../../../vi/5-workshop/5.4-s3-onprem/><b>5.4. </b>Truy cập S3 từ môi trường truyền thống
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.4-s3-onprem/5.4.1-prepare/ title="Chuẩn bị tài nguyên" class=dd-item><a href=../../../vi/5-workshop/5.4-s3-onprem/5.4.1-prepare/><b>5.4.1 </b>Chuẩn bị tài nguyên
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/ title="Tạo một S3 Interface endpoint" class=dd-item><a href=../../../vi/5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/><b>5.4.2 </b>Tạo một S3 Interface endpoint
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/ title="Kiểm tra Interface Endpoint" class=dd-item><a href=../../../vi/5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/><b>5.4.3 </b>Kiểm tra Interface Endpoint
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-s3-onprem/5.4.4-dns-simulation/ title="Mô phỏng On-premises DNS " class=dd-item><a href=../../../vi/5-workshop/5.4-s3-onprem/5.4.4-dns-simulation/><b>5.4.4 </b>Mô phỏng On-premises DNS
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/5.5-policy/ title="VPC Endpoint Policies" class=dd-item><a href=../../../vi/5-workshop/5.5-policy/><b>5.5 </b>VPC Endpoint Policies
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.6-cleanup/ title="Dọn dẹp tài nguyên" class=dd-item><a href=../../../vi/5-workshop/5.6-cleanup/><b>5.6. </b>Dọn dẹp tài nguyên
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/6-self-evaluation/ title="Tự đánh giá" class=dd-item><a href=../../../vi/6-self-evaluation/><b>6. </b>Tự đánh giá
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-feedback/ title="Chia sẻ, đóng góp ý kiến" class=dd-item><a href=../../../vi/7-feedback/><b>7. </b>Chia sẻ, đóng góp ý kiến
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://nguyenmaivy.github.io/nguyenmaivy/3-blogstranslated/3.7-blog7/>English</option><option id=vi value=https://nguyenmaivy.github.io/nguyenmaivy/vi/3-blogstranslated/3.7-blog7/ selected>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../../vi/>Báo cáo thực tập</a> > <a href=../../../vi/3-blogstranslated/>Các bài blogs đã dịch</a> > Blog 7</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#the-lambda-as-orchestrator-anti-pattern>The Lambda as orchestrator anti-pattern</a></li><li><a href=#rearchitecting-with-step-functions>Rearchitecting with Step Functions</a></li><li><a href=#comparing-lambda-function-as-orchestrator-to-step-functions>Comparing Lambda function as orchestrator to Step Functions</a></li><li><a href=#cân-nhắc-thực-hiện>Cân nhắc thực hiện</a></li><li><a href=#lợi-ích-của-việc-sử-dụng-step-functions>Lợi ích của việc sử dụng Step Functions</a></li><li><a href=#kết-luận>Kết luận</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Blog 7</h1><h1 id=tối-ưu-hóa-quy-trình-làm-việc-serverless-trên-aws-từ-aws-lambda-orchestration-đến-aws-step-functions>Tối ưu hóa quy trình làm việc Serverless trên AWS: Từ AWS Lambda orchestration đến AWS Step Functions</h1><p>Bài đăng trên blog này thảo luận về <a href=https://aws.amazon.com/lambda/>AWS Lambda</a> với tư cách là <a href=https://docs.aws.amazon.com/lambda/latest/operatorguide/anti-patterns.html>mẫu chống điều phối</a> và cách thiết kế lại các giải pháp serverless bằng cách sử dụng AWS Step Functions với tích hợp gốc.</p><p>Step Functions là dịch vụ quy trình làm việc không có máy chủ mà bạn có thể sử dụng để xây dựng các ứng dụng phân tán, tự động hóa quy trình, điều phối các dịch vụ vi mô cũng như tạo đường dẫn dữ liệu và máy học (ML). Step Functions cung cấp khả năng tích hợp gốc với hơn <a href=https://docs.aws.amazon.com/step-functions/latest/dg/connect-to-services.html>200 dịch vụ AWS</a> bên cạnh các API bên ngoài của bên thứ ba. Bạn có thể sử dụng các tiện ích tích hợp này để triển khai các giải pháp sẵn sàng sản xuất với ít nỗ lực hơn, giảm độ phức tạp của mã, cải thiện khả năng bảo trì lâu dài và giảm thiểu nợ kỹ thuật khi vận hành ở quy mô lớn.</p><hr><h2 id=the-lambda-as-orchestrator-anti-pattern>The Lambda as orchestrator anti-pattern</h2><p>Hãy cùng xem xét một anti-pattern phổ biến: sử dụng một Lambda function như một orchestrator để phân phối thông điệp qua nhiều kênh khác nhau. Hãy tưởng tượng tình huống thực tế sau đây — một hệ thống cần gửi thông báo (notifications) thông qua SMS hoặc email tùy theo user preferences, như được minh họa trong sơ đồ sau.</p><p><img src=../../../images/3-Blogstranslated/Blog7/anti-pattern.png></p><p>Các ví dụ về tải trọng cho kịch bản này là:</p><ol><li>Chỉ gửi SMS:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;body&#34;: </span>{
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;channel&#34;: </span><span style=color:#e6db74>&#34;sms&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;message&#34;: </span><span style=color:#e6db74>&#34;Hello from AWS Lambda!&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;phoneNumber&#34;: </span><span style=color:#e6db74>&#34;+1234567890&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;metadata&#34;: </span>{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;priority&#34;: </span><span style=color:#e6db74>&#34;high&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;category&#34;: </span><span style=color:#e6db74>&#34;notification&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>Chỉ gửi email:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;body&#34;: </span>{
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;channel&#34;: </span><span style=color:#e6db74>&#34;email&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;message&#34;: </span><span style=color:#e6db74>&#34;Hello from AWS Lambda!&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;email&#34;: </span>{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;to&#34;: </span><span style=color:#e6db74>&#34;recipient@example.com&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;subject&#34;: </span><span style=color:#e6db74>&#34;Test Notification&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;from&#34;: </span><span style=color:#e6db74>&#34;sender@example.com&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;metadata&#34;: </span>{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;priority&#34;: </span><span style=color:#e6db74>&#34;normal&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;category&#34;: </span><span style=color:#e6db74>&#34;notification&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li>Gửi cả SMS và email:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;body&#34;: </span>{
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;channel&#34;: </span><span style=color:#e6db74>&#34;both&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;message&#34;: </span><span style=color:#e6db74>&#34;Hello from AWS Lambda!&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;phoneNumber&#34;: </span><span style=color:#e6db74>&#34;+1234567890&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;email&#34;: </span>{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;to&#34;: </span><span style=color:#e6db74>&#34;recipient@example.com&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;subject&#34;: </span><span style=color:#e6db74>&#34;Test Notification&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;from&#34;: </span><span style=color:#e6db74>&#34;sender@example.com&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;metadata&#34;: </span>{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;priority&#34;: </span><span style=color:#e6db74>&#34;high&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;category&#34;: </span><span style=color:#e6db74>&#34;notification&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Đây là cách nó thường bắt đầu - với hàm Lambda đóng vai trò là người điều phối:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>import boto3</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>import json</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Initialize Lambda client</span>
</span></span><span style=display:flex><span><span style=color:#75715e># You can specify region if needed: boto3.client(&#39;lambda&#39;, region_name=&#39;us-east-1&#39;)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>lambda_client = boto3.client(&#39;lambda&#39;)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>def lambda_handler(event, context)</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Parse the incoming event</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>body = json.loads(event[&#39;body&#39;])</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Validate required fields</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>if &#39;channel&#39; not in body</span>:
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>return {</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>400</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#39;body&#39;</span>: <span style=color:#ae81ff>json.dumps(&#39;Missing channel parameter&#39;)</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#f92672>if &#39;message&#39; not in body</span>:
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>return {</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>400</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#39;body&#39;</span>: <span style=color:#ae81ff>json.dumps(&#39;Missing message content&#39;)</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#f92672>if body[&#39;channel&#39;] == &#39;both&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># Invoke SMS Lambda function</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>lambda_client.invoke(</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>FunctionName=&#39;send-sns&#39;,</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>InvocationType=&#39;Event&#39;,</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>Payload=json.dumps(body)</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># Invoke Email Lambda function</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>lambda_client.invoke(</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>FunctionName=&#39;send-email&#39;,</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>InvocationType=&#39;Event&#39;,</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>Payload=json.dumps(body)</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># Validate channel value</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>if body[&#39;channel&#39;] not in [&#39;sms&#39;, &#39;email&#39;]</span>:
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>return {</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>400</span>,
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#39;body&#39;</span>: <span style=color:#ae81ff>json.dumps(&#39;Invalid channel specified&#39;)</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            <span style=color:#75715e># Invoke function based on specified channel</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>function_name = &#39;send-sns&#39; if body[&#39;channel&#39;] == &#39;sms&#39; else &#39;send-email&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>lambda_client.invoke(</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>FunctionName=function_name,</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>InvocationType=&#39;Event&#39;,</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>Payload=json.dumps(body)</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>return {</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#39;body&#39;</span>: <span style=color:#ae81ff>json.dumps(&#39;Messages sent successfully&#39;)</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#f92672>except json.JSONDecodeError</span>:
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>return {</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>400</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#39;body&#39;</span>: <span style=color:#ae81ff>json.dumps(&#39;Invalid JSON in request body&#39;)</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    <span style=color:#f92672>except Exception as e</span>:
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>return {</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>500</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#39;body&#39;: json.dumps(f&#39;Error</span>: {<span style=color:#ae81ff>str(e)}&#39;)</span>
</span></span><span style=display:flex><span>        }
</span></span></code></pre></div><p>Cách tiếp cận này có các vấn đề sau:</p><ul><li><strong>Complex error handling</strong>: Orchestrator cần quản lý lỗi từ nhiều lần gọi function khác nhau.</li><li><strong>Tight coupling</strong>: Các function phụ thuộc trực tiếp vào nhau.</li><li><strong>Limited execution time</strong>: Orchestrator Lambda function tiếp tục chạy trong khi các sub Lambda function đang thực thi. Điều này có thể dẫn đến việc orchestrator Lambda function bị timeout.</li><li><strong>Idle resources</strong>: Bởi vì orchestrator Lambda function đang ở trạng thái nhàn rỗi trong khi chờ kết quả trả về từ các Lambda function khác, trong trường hợp này, người dùng phải trả tiền cho tài nguyên không hoạt động.</li></ul><hr><h2 id=rearchitecting-with-step-functions>Rearchitecting with Step Functions</h2><p>Bạn có thể xây dựng lại logic bằng cách sử dụng Step Functions và Amazon States Language để thay thế Lambda orchestrator function. Bạn có thể sử dụng Choice state trong Amazon States Language để xác định các điều kiện logic nhằm theo một nhánh cụ thể. Cách tiếp cận này giúp giảm độ phức tạp trong việc bảo trì code vì bạn định nghĩa các điều kiện bằng Amazon States Language. Bạn cũng có thể sử dụng nó để mở rộng chức năng với các thay đổi tối thiểu trong codebase.</p><p>Sơ đồ workflow Step Functions sau đây minh họa phiên bản được thiết kế lại của Orchestrator Lambda function trước đó:</p><p><img src=../../../images/3-Blogstranslated/Blog7/step-functions.png></p><p>Ngôn ngữ trạng thái Amazon sau đây thể hiện quy trình làm việc:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Comment&#34;: </span><span style=color:#e6db74>&#34;Multi-channel notification workflow&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;StartAt&#34;: </span><span style=color:#e6db74>&#34;ValidateInput&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;States&#34;: </span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ValidateInput&#34;: </span>{
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Type&#34;: </span><span style=color:#e6db74>&#34;Choice&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Choices&#34;: </span>[
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;And&#34;: </span>[
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;Variable&#34;: </span><span style=color:#e6db74>&#34;$.message&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;IsPresent&#34;: </span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;Variable&#34;: </span><span style=color:#e6db74>&#34;$.channel&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;IsPresent&#34;: </span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          ],
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;Next&#34;: </span><span style=color:#e6db74>&#34;DetermineChannel&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Default&#34;: </span><span style=color:#e6db74>&#34;ValidationError&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ValidationError&#34;: </span>{
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Type&#34;: </span><span style=color:#e6db74>&#34;Fail&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Error&#34;: </span><span style=color:#e6db74>&#34;ValidationError&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Cause&#34;: </span><span style=color:#e6db74>&#34;Required fields missing: message and/or channel&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;DetermineChannel&#34;: </span>{
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Type&#34;: </span><span style=color:#e6db74>&#34;Choice&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Choices&#34;: </span>[
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;Variable&#34;: </span><span style=color:#e6db74>&#34;$.channel&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;StringEquals&#34;: </span><span style=color:#e6db74>&#34;both&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;Next&#34;: </span><span style=color:#e6db74>&#34;ParallelNotification&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;Variable&#34;: </span><span style=color:#e6db74>&#34;$.channel&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;StringEquals&#34;: </span><span style=color:#e6db74>&#34;sms&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;Next&#34;: </span><span style=color:#e6db74>&#34;SendSMSOnly&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;Variable&#34;: </span><span style=color:#e6db74>&#34;$.channel&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;StringEquals&#34;: </span><span style=color:#e6db74>&#34;email&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;Next&#34;: </span><span style=color:#e6db74>&#34;SendEmailOnly&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Default&#34;: </span><span style=color:#e6db74>&#34;FailState&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ParallelNotification&#34;: </span>{
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Type&#34;: </span><span style=color:#e6db74>&#34;Parallel&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Branches&#34;: </span>[
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;StartAt&#34;: </span><span style=color:#e6db74>&#34;SendSMS&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;States&#34;: </span>{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;SendSMS&#34;: </span>{
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;Type&#34;: </span><span style=color:#e6db74>&#34;Task&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;Resource&#34;: </span><span style=color:#e6db74>&#34;arn:aws:states:::sns:publish&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;Parameters&#34;: </span>{
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Message.$&#34;: </span><span style=color:#e6db74>&#34;$.message&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;PhoneNumber.$&#34;: </span><span style=color:#e6db74>&#34;$.phoneNumber&#34;</span>
</span></span><span style=display:flex><span>              },
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;End&#34;: </span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;StartAt&#34;: </span><span style=color:#e6db74>&#34;SendEmail&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;States&#34;: </span>{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;SendEmail&#34;: </span>{
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;Type&#34;: </span><span style=color:#e6db74>&#34;Task&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;Parameters&#34;: </span>{
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;FromEmailAddress.$&#34;: </span><span style=color:#e6db74>&#34;$.email.from&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Destination&#34;: </span>{
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;ToAddresses.$&#34;: </span><span style=color:#e6db74>&#34;States.Array($.email.to)&#34;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;CcAddresses.$&#34;: </span><span style=color:#e6db74>&#34;States.ArrayGetItem(States.JsonToString($.email.cc), $)&#34;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;BccAddresses.$&#34;: </span><span style=color:#e6db74>&#34;States.ArrayGetItem(States.JsonToString($.email.bcc), $)&#34;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Content&#34;: </span>{
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;Simple&#34;: </span>{
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;Subject&#34;: </span>{
</span></span><span style=display:flex><span>                      <span style=color:#f92672>&#34;Data.$&#34;: </span><span style=color:#e6db74>&#34;$.email.subject&#34;</span>,
</span></span><span style=display:flex><span>                      <span style=color:#f92672>&#34;Charset&#34;: </span><span style=color:#e6db74>&#34;UTF-8&#34;</span>
</span></span><span style=display:flex><span>                    },
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;Body&#34;: </span>{
</span></span><span style=display:flex><span>                      <span style=color:#f92672>&#34;Text&#34;: </span>{
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&#34;Data.$&#34;: </span><span style=color:#e6db74>&#34;$.message&#34;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&#34;Charset&#34;: </span><span style=color:#e6db74>&#34;UTF-8&#34;</span>
</span></span><span style=display:flex><span>                      },
</span></span><span style=display:flex><span>                      <span style=color:#f92672>&#34;Html&#34;: </span>{
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&#34;Data.$&#34;: </span><span style=color:#e6db74>&#34;$.email.htmlBody&#34;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&#34;Charset&#34;: </span><span style=color:#e6db74>&#34;UTF-8&#34;</span>
</span></span><span style=display:flex><span>                      }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                  }
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;ReplyToAddresses.$&#34;: </span><span style=color:#e6db74>&#34;States.Array($.email.replyTo)&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;EmailTags&#34;: </span>[
</span></span><span style=display:flex><span>                  {
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;Name&#34;: </span><span style=color:#e6db74>&#34;channel&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;Value&#34;: </span><span style=color:#e6db74>&#34;email&#34;</span>
</span></span><span style=display:flex><span>                  },
</span></span><span style=display:flex><span>                  {
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;Name&#34;: </span><span style=color:#e6db74>&#34;messageType&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;Value.$&#34;: </span><span style=color:#e6db74>&#34;$.email.messageType&#34;</span>
</span></span><span style=display:flex><span>                  }
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;ConfigurationSetName.$&#34;: </span><span style=color:#e6db74>&#34;$.email.configurationSet&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;ListManagementOptions&#34;: </span>{
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;ContactListName.$&#34;: </span><span style=color:#e6db74>&#34;$.email.contactList&#34;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;TopicName.$&#34;: </span><span style=color:#e6db74>&#34;$.email.topic&#34;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>              },
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;Resource&#34;: </span><span style=color:#e6db74>&#34;arn:aws:states:::aws-sdk:sesv2:sendEmail&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;End&#34;: </span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;End&#34;: </span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;SendSMSOnly&#34;: </span>{
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Type&#34;: </span><span style=color:#e6db74>&#34;Task&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;: </span><span style=color:#e6db74>&#34;arn:aws:states:::sns:publish&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Parameters&#34;: </span>{
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Message.$&#34;: </span><span style=color:#e6db74>&#34;$.message&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;PhoneNumber.$&#34;: </span><span style=color:#e6db74>&#34;$.phoneNumber&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;End&#34;: </span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;SendEmailOnly&#34;: </span>{
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Type&#34;: </span><span style=color:#e6db74>&#34;Task&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Parameters&#34;: </span>{
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;FromEmailAddress.$&#34;: </span><span style=color:#e6db74>&#34;$.email.from&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Destination&#34;: </span>{
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;ToAddresses.$&#34;: </span><span style=color:#e6db74>&#34;States.Array($.email.to)&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Content&#34;: </span>{
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;Simple&#34;: </span>{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Subject&#34;: </span>{
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;Data.$&#34;: </span><span style=color:#e6db74>&#34;$.email.subject&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;Charset&#34;: </span><span style=color:#e6db74>&#34;UTF-8&#34;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Body&#34;: </span>{
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;Text&#34;: </span>{
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Data.$&#34;: </span><span style=color:#e6db74>&#34;$.message&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Charset&#34;: </span><span style=color:#e6db74>&#34;UTF-8&#34;</span>
</span></span><span style=display:flex><span>              },
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;Html&#34;: </span>{
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Data.$&#34;: </span><span style=color:#e6db74>&#34;$.email.htmlBody&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Charset&#34;: </span><span style=color:#e6db74>&#34;UTF-8&#34;</span>
</span></span><span style=display:flex><span>              }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;: </span><span style=color:#e6db74>&#34;arn:aws:states:::aws-sdk:sesv2:sendEmail&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;End&#34;: </span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;FailState&#34;: </span>{
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Type&#34;: </span><span style=color:#e6db74>&#34;Fail&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Cause&#34;: </span><span style=color:#e6db74>&#34;Invalid channel specified&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Cách triển khai Step Functions này mang lại một số lợi ích sau:</p><ul><li><strong>Native service integration</strong>: Tích hợp trực tiếp với <a href=https://aws.amazon.com/sns>Amazon Simple Notification Service (Amazon SNS)</a>, <a href=https://aws.amazon.com/ses>Amazon Simple Email Service (Amazon SES)</a>, <a href=https://aws.amazon.com/dynamodb>Amazon DynamoDB</a>, và <a href=https://aws.amazon.com/cloudwatch>Amazon CloudWatch</a> giúp loại bỏ nhu cầu sử dụng các wrapper Lambda functions.</li><li><strong>Visual workflow</strong>: Luồng thực thi có thể được quan sát và duy trì dễ dàng thông qua AWS Management Console.</li><li><strong>Built-in error handling</strong>: Chính sách Retry và error states có thể được định nghĩa một cách declaratively.</li><li><strong>Parallel execution</strong>: Parallel state xử lý việc gửi dữ liệu đến nhiều kênh một cách hiệu quả.
Simplified logic: Choice state thay thế cho các câu lệnh if-else phức tạp.</li><li><strong>Centralized data flow</strong>: Input và output được quản lý nhất quán giữa các states.</li><li><strong>Enhanced workflow duration capabilities</strong>: Step Functions Standard workflows hỗ trợ các phiên thực thi có thể chạy lên đến một năm, so với giới hạn 15 phút của Lambda functions.</li></ul><hr><h2 id=comparing-lambda-function-as-orchestrator-to-step-functions>Comparing Lambda function as orchestrator to Step Functions</h2><p>Tóm tắt các đặc điểm khác nhau được triển khai giữa Lambda function as orchestrator và Step Functions được thể hiện trong bảng sau:</p><table><thead><tr><th style=text-align:left>Tính năng</th><th style=text-align:left>Lambda function as orchestrator</th><th style=text-align:left>Step Functions</th></tr></thead><tbody><tr><td style=text-align:left><strong>Logic điều phối</strong></td><td style=text-align:left>Được triển khai trong Python với các câu lệnh if-else lồng nhau.</td><td style=text-align:left>Được định nghĩa khai báo bằng trạng thái Choice</td></tr><tr><td style=text-align:left><strong>Phân phối đa kênh</strong></td><td style=text-align:left>Gọi hàm tuần tự. Thực thi song song sử dụng logic của hàm.</td><td style=text-align:left>Thực thi song song sử dụng trạng thái Parallel</td></tr><tr><td style=text-align:left><strong>Tích hợp dịch vụ</strong></td><td style=text-align:left>Yêu cầu SDK calls hoặc các Lambda functions riêng biệt.</td><td style=text-align:left>Tích hợp trực tiếp với các dịch vụ AWS (Amazon SNS, DynamoDB)</td></tr><tr><td style=text-align:left><strong>Xử lý lỗi</strong></td><td style=text-align:left>Khối try-except tùy chỉnh trong Python.</td><td style=text-align:left>Trạng thái lỗi tích hợp sẵn và chính sách thử lại</td></tr><tr><td style=text-align:left><strong>Duy trì dữ liệu</strong></td><td style=text-align:left>Code tùy chỉnh để tương tác với DynamoDB.</td><td style=text-align:left>Tích hợp DynamoDB gốc với tác vụ putItem</td></tr><tr><td style=text-align:left><strong>Ghi nhật ký số liệu</strong></td><td style=text-align:left>Code tùy chỉnh để gọi CloudWatch.</td><td style=text-align:left>Tích hợp SDK CloudWatch Metrics</td></tr></tbody></table><hr><h2 id=cân-nhắc-thực-hiện>Cân nhắc thực hiện</h2><p>Xem xét các yếu tố sau khi re-architecting một Lambda function orchestrator sang Step Functions:</p><ul><li><a href=https://docs.aws.amazon.com/step-functions/latest/dg/choosing-workflow-type.html>State machine type</a>: Chọn giữa Standard (thời gian chạy lên đến 1 năm) và Express (thời gian chạy lên đến 5 phút) tùy theo nhu cầu của bạn.</li><li><a href=https://docs.aws.amazon.com/step-functions/latest/dg/concepts-input-output-filtering.html>Input/output management</a>: Việc thao tác với parameters giúp giảm khối lượng phát triển và mang lại các lựa chọn linh hoạt hơn để triển khai workflow:<ul><li>Parameters: Chọn các trường input cụ thể để truyền sang state tiếp theo.</li><li>ResultSelector: Lọc state response để chỉ bao gồm các trường có liên quan.</li><li>ResultPath: Lưu processed result vào một path cụ thể trong state input.</li><li>OutputPath: Xác định dữ liệu nào sẽ được truyền sang state tiếp theo</li></ul></li></ul><p>Một code snippet cho các tính năng này như sau:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>&#34;ProcessOrder&#34;: </span>{
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Type&#34;: </span><span style=color:#e6db74>&#34;Task&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Resource&#34;: </span><span style=color:#e6db74>&#34;arn:aws:states:::lambda:invoke&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Parameters&#34;: </span>{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;FunctionName&#34;: </span><span style=color:#e6db74>&#34;ProcessOrderFunction&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Payload&#34;: </span>{
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;orderId.$&#34;: </span><span style=color:#e6db74>&#34;$.orderId&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;customerId.$&#34;: </span><span style=color:#e6db74>&#34;$.customerId&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;ResultSelector&#34;: </span>{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;orderStatus.$&#34;: </span><span style=color:#e6db74>&#34;$.Payload.status&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;processedDate.$&#34;: </span><span style=color:#e6db74>&#34;$.Payload.timestamp&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;ResultPath&#34;: </span><span style=color:#e6db74>&#34;$.orderProcessing&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;OutputPath&#34;: </span><span style=color:#e6db74>&#34;$.orderProcessing&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Next&#34;: </span><span style=color:#e6db74>&#34;NotifyCustomer&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><a href=https://docs.aws.amazon.com/step-functions/latest/dg/concepts-error-handling.html>Xử lý lỗi</a>: Triển khai retry policies và bắt lỗi (catch errors) ở cả hai cấp độ: task và state machine.</li><li><a href=https://docs.aws.amazon.com/step-functions/latest/dg/procedure-cw-metrics.html>Giám sát</a>: Thiết lập CloudWatch logs và metrics cho state machine của bạn để theo dõi executions và performance.</li></ul><hr><h2 id=lợi-ích-của-việc-sử-dụng-step-functions>Lợi ích của việc sử dụng Step Functions</h2><p>Việc sử dụng Step Functions trong các kịch bản rearchitecting mang lại những lợi ích sau:</p><ul><li><strong>Reduced code complexity</strong>: Business logic giờ đây được định nghĩa trong Amazon States Language thay vì phân tán qua nhiều Lambda functions.</li><li><strong>Improved maintainability</strong>: Các developer có thể thay đổi workflow bằng cách chỉnh sửa Amazon States Language, thay vì phải sửa đổi nhiều Lambda functions.</li><li><strong>Native AWS service integrations</strong>: Step Functions cung cấp direct integrations với hơn 200 AWS services, cho phép bạn kết nối và phối hợp các AWS resources mà không cần viết custom integration code.</li><li><strong>Cost optimization</strong>: Bằng cách sử dụng direct service integrations, số lượng Lambda invocations giảm đi, giúp tiết kiệm chi phí.</li><li><strong>Long-running processes</strong>: Step Functions có thể quản lý workflows chạy đến 1 năm, vượt xa giới hạn 15 phút của Lambda functions.</li></ul><hr><h2 id=kết-luận>Kết luận</h2><p>Rearchitecting các Lambda-based applications bằng Step Functions có thể cải thiện đáng kể maintainability, scalability, và operational efficiency. Bằng cách chuyển orchestration logic vào Step Functions và tận dụng native service integrations, bạn có thể tạo ra các serverless applications mạnh mẽ và dễ quản lý hơn.
Mặc dù bài viết này tập trung vào message distribution workflow, nhưng các nguyên tắc được trình bày có thể áp dụng cho nhiều serverless architectures khác nhau. Khi bạn phát triển ứng dụng của mình, hãy cân nhắc cách Step Functions có thể giúp bạn xây dựng các giải pháp resilient và scalable hơn.
Để tìm hiểu thêm về serverless architectures, hãy truy cập <a href=https://serverlessland.com/>Serverless Land</a>.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../../vi/3-blogstranslated/3.6-blog6/ title="Blog 5"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../../vi/3-blogstranslated/3.8-blog8/ title="Blog 8" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../../js/clipboard.min.js?1765465502></script><script src=../../../js/perfect-scrollbar.min.js?1765465502></script><script src=../../../js/perfect-scrollbar.jquery.min.js?1765465502></script><script src=../../../js/jquery.sticky.js?1765465502></script><script src=../../../js/featherlight.min.js?1765465502></script><script src=../../../js/highlight.pack.js?1765465502></script><script>hljs.initHighlightingOnLoad()</script><script src=../../../js/modernizr.custom-3.6.0.js?1765465502></script><script src=../../../js/learn.js?1765465502></script><script src=../../../js/hugo-learn.js?1765465502></script><link href=../../../mermaid/mermaid.css?1765465502 rel=stylesheet><script src=../../../mermaid/mermaid.js?1765465502></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>